<?xml version="1.0" encoding="UTF-8"?>
<job xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="urn:proactive:jobdescriptor:dev ../../src/scheduler/src/org/ow2/proactive/scheduler/common/xml/schemas/jobdescriptor/dev/schedulerjob.xsd"
    xmlns="urn:proactive:jobdescriptor:dev" name="Matlab_job" priority="normal" logFile="matlab_job.log" >
    <variables>
        <variable name="MATLAB_SCRIPTS"
            value="${pa.scheduler.home}/samples/jobs_descriptors/job_matlab" />
    </variables>
    <description>A simple Matlab taskflow, which computes the sum of a randomly-generated array</description>
    <taskFlow>
        <task name="splitter">
            <description>Splits a big array</description>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabSplitter">
                <parameters>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/splitter.m"/>
                    <parameter name="input" value="in=round(rand(1,1000000)*100-50)"/>
                    <parameter name="number_of_children" value="6"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="sum1">
            <description>Calculates the sum of the elements in the array</description>
            <depends>
                <task ref="splitter"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabTask">
                <parameters>
                    <parameter name="index" value="0"/>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/summer.m"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="sum2">
            <description>Calculates the sum of the elements in the array</description>
            <depends>
                <task ref="splitter"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabTask">
                <parameters>
                    <parameter name="index" value="1"/>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/summer.m"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="sum3">
            <description>Calculates the sum of the elements in the array</description>
            <depends>
                <task ref="splitter"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabTask">
                <parameters>
                    <parameter name="index" value="2"/>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/summer.m"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="sum4">
            <description>Calculates the sum of the elements in the array</description>
            <depends>
                <task ref="splitter"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabTask">
                <parameters>
                    <parameter name="index" value="3"/>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/summer.m"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="sum5">
            <description>Calculates the sum of the elements in the array</description>
            <depends>
                <task ref="splitter"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabTask">
                <parameters>
                    <parameter name="index" value="4"/>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/summer.m"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="sum6">
            <description>Calculates the sum of the elements in the array</description>
            <depends>
                <task ref="splitter"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabTask">
                <parameters>
                    <parameter name="index" value="5"/>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/summer.m"/>
                </parameters>
            </javaExecutable>
        </task>
        <task name="collector" preciousResult="true">
            <description>Calculates the global sum of each intermediate sum</description>
            <depends>
                <task ref="sum1"/>
                <task ref="sum2"/>
                <task ref="sum3"/>
                <task ref="sum4"/>
                <task ref="sum5"/>
                <task ref="sum6"/>
            </depends>
            <selection>
                <script>
                    <file url="file:${pa.scheduler.home}/samples/scripts/selection/checkMatlab.js"/>
                </script>
            </selection>
            <javaExecutable class="org.ow2.proactive.scheduler.ext.matlab.worker.MatlabCollector">
                <parameters>
                    <parameter name="scriptFile" value="${MATLAB_SCRIPTS}/collector.m"/>
                </parameters>
            </javaExecutable>
        </task>
    </taskFlow>
</job>
