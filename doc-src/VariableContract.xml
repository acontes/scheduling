<!-- Converted by db4-upgrade version 1.0 -->

<chapter xmlns="http://docbook.org/ns/docbook" version="5.0" xml:id="VariableContract"><info><title>Variable Contracts for Descriptors</title></info>
  

  <section><info><title>Variable Contracts for Descriptors</title></info>
    

    <section><info><title>Principle</title></info>
      

      <para>The objective of this feature is to allow the use of variables
      with XML descriptors. Variables can be defined: directly in the
      descriptor, using independent files, or inside the deploying
      application's code (with an API).</para>

      <para>The variable tags are usefull inside a descriptor because they can
      factorize frequent parameters. (For example, a variable like
      ${PROACTIVE_HOME} can be defined, set and used in an XML Descriptor.)
      But also, because they can be used to establish a contract between the
      Program and the Descriptor.</para>
    </section>

    <section xml:id="dbdoclet.id.VariableContract_html_variableTypes"><info><title>    Variable Types</title></info>
      

      <informaltable><info><title>Variable Types</title></info>
        

        <tgroup cols="4">
          <colspec align="center"/>

          <thead>
            <row>
              <entry align="center">Type</entry>

              <entry align="center">Ability to set value</entry>

              <entry align="center">Ability to set empty value</entry>

              <entry align="center">Priority</entry>
            </row>
          </thead>

          <tbody>
            <row>
              <entry><emphasis role="bold">DescriptorVariable</emphasis></entry>

              <entry>Descriptor</entry>

              <entry>Program</entry>

              <entry>Descriptor</entry>
            </row>

            <row>
              <entry><emphasis role="bold">ProgramVariable</emphasis></entry>

              <entry>Program</entry>

              <entry>Descriptor</entry>

              <entry>Program</entry>
            </row>

            <row>
              <entry><emphasis role="bold">DescriptorDefaultVariable</emphasis></entry>

              <entry>Descriptor, Program</entry>

              <entry>-</entry>

              <entry>Program</entry>
            </row>

            <row>
              <entry><emphasis role="bold">ProgramDefaultVariable</emphasis></entry>

              <entry>Program, Descriptor</entry>

              <entry>-</entry>

              <entry>Descriptor</entry>
            </row>

            <row>
              <entry><emphasis role="bold">JavaPropertyVariable</emphasis></entry>

              <entry>Descriptor, Program</entry>

              <entry>-</entry>

              <entry>JavaProperty</entry>
            </row>

            <row>
              <entry><emphasis role="bold">JavaPropertyDescriptorDefault</emphasis></entry>

              <entry>JavaProperty, Descriptor, Program</entry>

              <entry>Program</entry>

              <entry>JavaProperty, Descriptor, Program</entry>
            </row>

            <row>
              <entry><emphasis role="bold">JavaPropertyProgramDefault</emphasis></entry>

              <entry>JavaProperty, Descriptor, Program</entry>

              <entry>Descriptor</entry>

              <entry>JavaProperty, Program, Descriptor</entry>
            </row>
          </tbody>
        </tgroup>
      </informaltable>

      <para>Variables can be set in more than one place. When the value is set
      on multiple places, then the definition specified in the priority column
      will take precedence. In the priority column, items towards the left
      have more priority.</para>
    </section>

    <section xml:id="dbdoclet.id.VariableContract_html_variableTypesDesc"><info><title> Variable Types User Guide</title></info>
      

      <para>To help identify the user cases where the variable types might be
      useful, we have defined the concept of programmer and deployer. The
      programmer is the person writing the application code. The deployer
      corresponds to the responsible of writing the deployment descriptor. The
      variables represent rights and responsabilities between the two parties
      (contract) as specified in the following table:</para>

      <para><informaltable>
          <tgroup cols="3">
            <tbody>
              <row>
                <entry><para> <emphasis role="bold">Type</emphasis>
                </para></entry>

                <entry><para> <emphasis role="bold">Behavior</emphasis>
                </para></entry>

                <entry><para> <emphasis role="bold">When to use this
                type</emphasis> </para></entry>
              </row>

              <row>
                <entry><para> <emphasis role="bold">descriptorVariable</emphasis> </para></entry>

                <entry><para>The value has to be set in the descriptor, and
                cannot be specified in the program.</para></entry>

                <entry><para>The deployer wants to use a value, without
                giving the possibility to the programmer to modify it. The
                programmer can define this variable to empty, to force the
                descriptor to set a value.</para></entry>
              </row>

              <row>
                <entry><para> <emphasis role="bold">programVariable</emphasis>
                </para></entry>

                <entry><para>The value must be set in the program, and cannot
                be specified in the descriptor.</para></entry>

                <entry><para>The programmer wants to use a value, without
                giving the possibility to the descriptor to modify it. The
                descriptor can define this variable to empty, to force the
                programmer to set a value.</para></entry>
              </row>

              <row>
                <entry><para> <emphasis role="bold">descriptorDefaultVariable</emphasis>
                </para></entry>

                <entry><para>A default value must be specified in the
                descriptor. The programmer has the ability to change the
                value in the program. If the value is changed in
                the program, then this new value will have precedence over the
                one defined in the descriptor.</para></entry>

                <entry><para>The programmer may override the default value, but 
				the responsability of setting a default belongs to the 
                deployer. </para></entry>
              </row>

              <row>
                <entry><para> <emphasis role="bold">programDefaultVariable</emphasis> </para></entry>

                <entry><para>A default value must be specified in the program.
                The descriptor has the ability to change the value.
                If the value is changed in the descriptor, then
                this new value will have precedence over the one defined in
                the program.</para></entry>

                <entry><para>The deployer may override the default value,
                but the responsability of setting a default belongs to the
                programmer.</para></entry>
              </row>

              <row>
                <entry><para> <emphasis role="bold">javaPropertyVariable</emphasis> </para></entry>

                <entry><para>Takes the value from the corresponding Java
                property.</para></entry>

                <entry><para>When a variable will only be known at runtime
                through the Java properties, and no default has to be provided
                by the descriptor or the application.</para></entry>
              </row>

              <row>
                <entry><emphasis role="bold">javaPropertyDescriptorDefault</emphasis></entry>

                <entry>Takes the value from the corresponding java property. A
                default value can also be set from the descriptor or the
                program. If no property is found, the descriptor default value
                will override the program default value.</entry>

                <entry>When the descriptor sets a default value, that can be
                overrided at deployment using a java property.</entry>
              </row>

              <row>
                <entry><emphasis role="bold">javaPropertyProgramDefault</emphasis></entry>

                <entry>Takes the value from the corresponding java property. A
                defualt value can also be set from the program or the
                descriptor. If no property is found, the program default value
                will override the program default value</entry>

                <entry>When the program sets a default value, than can be
                overrided at deployment using a java property.</entry>
              </row>
            </tbody>
          </tgroup>
        </informaltable></para>
    </section>

    <section><info><title>Variables Example</title></info>
      

      <section><info><title>Descriptor Variables</title></info>
        

        <indexterm><primary>Descriptor Variables</primary></indexterm>

        <para>All variables must be set in a variable section at the beginning
        of the descriptor file in the following way:</para>

        <screen>         &lt;variables&gt;
         &lt;<emphasis role="bold">descriptorVariable</emphasis> name="<emphasis role="bold">PROACTIVE_HOME</emphasis>" value="<emphasis role="bold">ProActive/dist/ProActive</emphasis>"/&gt;
         &lt;<emphasis role="bold">descriptorDefaultVariable</emphasis> name="<emphasis role="bold">NUMBER_OF_VIRTUAL_NODES</emphasis>" value="<emphasis role="bold">20</emphasis>"/&gt;
         &lt;<emphasis role="bold">programVariable</emphasis> name="<emphasis role="bold">VIRTUAL_NODE_NAME</emphasis>"/&gt;
         &lt;<emphasis role="bold">javaPropertyVariable</emphasis> name="<emphasis role="bold">java.home</emphasis>"/&gt;
         &lt;<emphasis role="bold">javaPropertyDescriptorDefault</emphasis> name="<emphasis role="bold">host.name</emphasis>" value="<emphasis role="bold">localhost</emphasis>"/&gt; 
         &lt;<emphasis role="bold">javaPropertyProgramDefault</emphasis> name="<emphasis role="bold">priority.queue</emphasis>"/&gt; 

         &lt;!-- Include external variables from files--&gt;
         &lt;<emphasis role="bold">includeXMLFile</emphasis> location="<emphasis role="bold">file.xml</emphasis>"/&gt;
         &lt;<emphasis role="bold">includePropertyFile</emphasis> location="<emphasis role="bold">file.properties</emphasis>"/&gt;
         &lt;/variables&gt;
         ...
         &lt;!-- Usage example--&gt;
         &lt;classpath&gt;
         &lt;absolutePath value="<emphasis role="bold">${USER_HOME}/${PROACTIVE_HOME}/ProActive.jar</emphasis>"/&gt;
         ...
         &lt;/classpath&gt;
         ...</screen>
      </section>

      <section><info><title>Program Variables</title></info>
        

        <screen>         XML_LOCATION="/home/user/descriptor.xml";
         VariableContract variableContract= new VariableContractImpl();
         variableContract.setVariableFromProgram( "<emphasis role="bold">VIRTUAL_NODE_NAME</emphasis>", "<emphasis role="bold">testnode</emphasis>", <emphasis role="bold">VariableContractType.ProgramVariable</emphasis>);
         variableContract.setVariableFromProgram( "<emphasis role="bold">NUMBER_OF_VIRTUAL_NODES</emphasis>", "<emphasis role="bold">10</emphasis>", <emphasis role="bold">VariableContractType.DescriptorDefaultVariable</emphasis>);
         variableContract.setVariableFromProgram( "<emphasis role="bold">priority.queue</emphasis>", "<emphasis role="bold">vip</emphasis>", <emphasis role="bold">VariableContractType.JavaPropertyProgramDefault</emphasis>);
         ProActiveDescriptor pad = PADeployment.getProactiveDescriptor(XML_LOCATION, variableContract);

         //Usage example
         VariableContract vc=pad.getVariableContract;
         String proActiveHome=vc.getValue("PROACTIVE_HOME");</screen>
      </section>
    </section>

    <section><info><title>External Variable Definitions Files</title></info>
      

      <section><info><title>XML Files</title></info>
        

        <para>Is built using XML property tags.</para>

        <para><emphasis role="bold">File: file.xml</emphasis></para>

        <screen>&lt;!-- Definition of the specific context --&gt;
&lt;variables&gt;
  &lt;<emphasis role="bold">descriptorVariable</emphasis> name="<emphasis role="bold">USER_HOME</emphasis>" value="<emphasis role="bold">/usr/home/team</emphasis>"/&gt;
  &lt;<emphasis role="bold">descriptorVariable</emphasis> name="<emphasis role="bold">PROACTIVE_HOME</emphasis>" value="<emphasis role="bold">ProActive/dist/ProActive</emphasis>"/&gt;
  &lt;<emphasis role="bold">descriptorVariable</emphasis> name="<emphasis role="bold">NUM_NODES</emphasis>" value="<emphasis role="bold">45</emphasis>"/&gt;
&lt;/variables&gt;                 </screen>
      </section>

      <section><info><title>Properties Files</title></info>
        

        <para>This approach uses <link xmlns:xlink="http://www.w3.org/1999/xlink" xlink:href="http://java.sun.com/j2se/1.4.2/docs/api/java/util/Properties.html#load(java.io.InputStream)">Sun
        microsystems properties file format</link>. The format is plain text
        with one definition per line in the format <emphasis role="bold">variable = value</emphasis>, as shown in the following
        example:</para>

        <para><emphasis role="bold">File: file.properties</emphasis></para>

        <screen># Definition of the specific context
USER_HOME = /usr/home/team
PROACTIVE_HOME = ProActive/dist/ProActive
NUM_NODES: 45                 </screen>

        <para>Variables defined in this format will be declared as <emphasis role="bold">DescriptorVariable</emphasis> type. Note that colon (:)
        can be used instead of equal (=).</para>
      </section>
    </section>

    <section><info><title>Program Variable API</title></info>
      

      <section><info><title>Relevant import packages</title></info>
        

        <screen>import org.objectweb.proactive.core.xml.VariableContract;
        import org.objectweb.proactive.core.xml.VariableContractImpl;
import org.objectweb.proactive.core.xml.VariableContractType;        </screen>
      </section>

      <section><info><title>Available Variable Types</title></info>
        

        <itemizedlist>
          <listitem>
            <para>VariableContractType.<emphasis role="bold">DefaultVariable</emphasis></para>
          </listitem>

          <listitem>
            <para>VariableContractType.<emphasis role="bold">DescriptorDefaultVariable</emphasis></para>
          </listitem>

          <listitem>
            <para>VariableContractType.<emphasis role="bold">ProgramVariable</emphasis></para>
          </listitem>

          <listitem>
            <para>VariableContractType.<emphasis role="bold">ProgramDefaultVariable</emphasis></para>
          </listitem>

          <listitem>
            <para>VariableContractType.<emphasis role="bold">JavaPropertyVariable</emphasis></para>
          </listitem>

          <listitem>
            <para>VariableContractType.<emphasis role="bold">JavaPropertyDescriptorDefault</emphasis></para>
          </listitem>

          <listitem>
            <para>VariableContractType.<emphasis role="bold">JavaPropertyProgramDefault</emphasis></para>
          </listitem>
        </itemizedlist>
      </section>

      <section><info><title>API</title></info>
        

        <para>The API for setting variables from the Program is shown below.
        The <emphasis role="bold">name</emphasis> corresponds to the variable
        name, and the <emphasis role="bold">value</emphasis> to the variable
        content. The <emphasis role="bold">type</emphasis> corresponds to a
        VariableContractType.</para>

        <screen>public void VariableContract.setVariableFromProgram( String <emphasis role="bold">name</emphasis>, String <emphasis role="bold">value</emphasis>, VariableContractType <emphasis role="bold">type</emphasis>);
public void VariableContract.setVariableFromProgram( HashMap <emphasis role="bold">map</emphasis>, VariableContractType <emphasis role="bold">type</emphasis>);
</screen>

        <para>The API for adding a multiple variables is shown above. The
        variable <emphasis role="bold">name</emphasis>/<emphasis role="bold">value</emphasis> pair is specified as the key/content of
        the HashMap.</para>
      </section>
    </section>
  </section>
</chapter>
