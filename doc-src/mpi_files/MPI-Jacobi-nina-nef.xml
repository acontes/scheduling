<?xml version="1.0" encoding="UTF-8"?>
<ProActiveDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:noNamespaceSchemaLocation=
"http://www-sop.inria.fr/oasis/proactive/schema/3.2/DescriptorSchema.xsd">
	<variables>
		<descriptorVariable name="PROACTIVE_HOME" value="ProActive"/>
		<descriptorVariable name="LOCAL_HOME" value="/home/smariani"/>
		<descriptorVariable name="REMOTE_HOME_NEF" value="/home/smariani"/>
		<descriptorVariable name="REMOTE_HOME_NINA" value="/user/smariani/home"/>
		<descriptorVariable name="MPIRUN_PATH_NEF" value="/usr/src/redhat/BUILD/mpich-1.2.6/bin/mpirun"/>
		<descriptorVariable name="MPIRUN_PATH_NINA" value="/user/smariani/home/mpich-1.2.6/bin/mpirun"/>
		<descriptorVariable name="QSUB_PATH" value="/opt/torque/bin/qsub"/>
	</variables>
	<componentDefinition>
		<virtualNodesDefinition>
			<virtualNode name="Cluster_Nef" />
			<virtualNode name="Cluster_Nina" />
		</virtualNodesDefinition>
	</componentDefinition>
	<deployment>
		<mapping>
			<map virtualNode="Cluster_Nef">
				<jvmSet>
					<vmName value="Jvm1" />
				</jvmSet>
			</map>
			<map virtualNode="Cluster_Nina">
				<jvmSet>
					<vmName value="Jvm2" />
				</jvmSet>
				
			</map>
		</mapping>
		<jvms>
			<jvm name="Jvm1">
				<creation>
					<processReference refid="sshProcess_nef" />
				</creation>
			</jvm>
			<jvm name="Jvm2">
				<creation>
					<processReference refid="sshProcess_nina" />
				</creation>
			</jvm>
		</jvms>
	</deployment>
	<fileTransferDefinitions>
		<fileTransfer id="JACOBI">
			<!-- Transfer mpi program on remote hosts -->
			<file src="jacobi" dest="jacobi" />
		</fileTransfer>
	</fileTransferDefinitions>
	<infrastructure>
		<processes>			

			<processDefinition id="localJVM_NEF">
				<jvmProcess class="org.objectweb.proactive.core.process.JVMNodeProcess">
					<classpath>
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/ProActive.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/asm.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/log4j.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/components/fractal.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/xercesImpl.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/bouncycastle.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/trilead-ssh2.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/lib/javassist.jar" />
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/classes" />
					</classpath>
					<javaPath>
						<absolutePath value="${REMOTE_HOME_NEF}/jdk1.5.0_05/bin/java" />
					</javaPath>
					<policyFile>
						<absolutePath value="${REMOTE_HOME_NEF}/proactive.java.policy" />
					</policyFile>
					<log4jpropertiesFile>
						<absolutePath value="${REMOTE_HOME_NEF}/${PROACTIVE_HOME}/compile/proactive-log4j" />
					</log4jpropertiesFile>
					<jvmParameters>
						<parameter value="-Dproactive.useIPaddress=true" />
						<parameter value="-Dproactive.rmi.port=6099" />
						<!--  DO NOT FORGET TO SET THE java.library.path VARIABLE to the remote directory path of the application -->
						<parameter value="-Djava.library.path=${REMOTE_HOME_NEF}/MyApp" />
					</jvmParameters>
				</jvmProcess>
			</processDefinition>
			
			<processDefinition id="localJVM_NINA">
				<jvmProcess class="org.objectweb.proactive.core.process.JVMNodeProcess">
					<classpath>
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/ProActive.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/asm.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/log4j.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/components/fractal.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/xercesImpl.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/bouncycastle.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/trilead-ssh2.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/lib/javassist.jar" />
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/classes" />
					</classpath>
					<javaPath>
						<absolutePath value="/user/smariani/home/NOSAVE/jdk1.5.0_05/bin/java"/>
					</javaPath>
					<policyFile>
						<absolutePath value="${REMOTE_HOME_NINA}/proactive.java.policy"/>
					</policyFile>
					<log4jpropertiesFile>
						<absolutePath value="${REMOTE_HOME_NINA}/${PROACTIVE_HOME}/compile/proactive-log4j"/>
					</log4jpropertiesFile>
					<jvmParameters>
						<parameter value="-Dproactive.useIPaddress=true" />
						<parameter value="-Dproactive.rmi.port=6099" />
						<!--  DO NOT FORGET TO SET THE java.library.path VARIABLE to the remote directory path of the application -->
						<parameter value="-Djava.library.path=${REMOTE_HOME_NINA}/MyApp" />
					</jvmParameters>
				</jvmProcess>
			</processDefinition>
			
			
			<!-- pbs Process -->
			<processDefinition id="pbsProcess">
				<pbsProcess class="org.objectweb.proactive.core.process.pbs.PBSSubProcess">
					<processReference refid="localJVM_NEF" />
					<commandPath value="${QSUB_PATH}" />
					<pbsOption>
						<!-- ask for 16 nodes on cluster nef (8 hosts, 2 nodes per machine)-->
						<hostsNumber>8</hostsNumber>
						<processorPerNode>2</processorPerNode>
						<bookingDuration>01:00:00</bookingDuration>
						<scriptPath>
							<absolutePath value="${REMOTE_HOME_NEF}/pbsStartRuntime.sh" />
						</scriptPath>
					</pbsOption>
				</pbsProcess>
			</processDefinition>
			
			
			<processDefinition id="lsfProcess">
				<bsubProcess class="org.objectweb.proactive.core.process.lsf.LSFBSubProcess">
					<processReference refid="localJVM_NINA"/>
						<bsubOption>
						<!-- ask for 16 nodes on cluster nina (8 hosts, 2 nodes per machine)-->
						<processor>16</processor>
						<resourceRequirement value="span[ptile=2]"/>
						<scriptPath>
							<absolutePath value="${REMOTE_HOME_NINA}/startRuntime.sh"/>
						</scriptPath>
						</bsubOption>
				</bsubProcess>
			</processDefinition>
			
			<!-- mpi Process -->
			<processDefinition id="mpiProcess_nef">
				<mpiProcess class="org.objectweb.proactive.core.process.mpi.MPIDependentProcess"  mpiFileName="jacobi" >
					<commandPath value="${MPIRUN_PATH_NEF}" />
					<mpiOptions>
						<processNumber>16</processNumber>
						<localRelativePath>
							<relativePath origin="user.home" value="Test" />
						</localRelativePath>
						<remoteAbsolutePath>
							<absolutePath value="${REMOTE_HOME_NEF}/MyApp" />
						</remoteAbsolutePath>
					</mpiOptions>
				</mpiProcess>
			</processDefinition>
			
			<!-- mpi Process -->
			<processDefinition id="mpiProcess_nina">
				<mpiProcess class="org.objectweb.proactive.core.process.mpi.MPIDependentProcess"  mpiFileName="jacobi" >
					<commandPath value="${MPIRUN_PATH_NINA}" />
					<mpiOptions>
						<processNumber>16</processNumber>
						<localRelativePath>
							<relativePath origin="user.home" value="Test" />
						</localRelativePath>
						<remoteAbsolutePath>
							<absolutePath value="${REMOTE_HOME_NINA}/MyApp" />
						</remoteAbsolutePath>
					</mpiOptions>
				</mpiProcess>
			</processDefinition>
			
			<!-- dependent process -->
			<processDefinition id="dpsProcess_nef">
				<dependentProcessSequence class="org.objectweb.proactive.core.process.DependentListProcess">
					<processReference refid="pbsProcess" />
					<processReference refid="mpiProcess_nef" />
				</dependentProcessSequence>
			</processDefinition>
			
			<!-- dependent process -->
			<processDefinition id="dpsProcess_nina">
				<dependentProcessSequence class="org.objectweb.proactive.core.process.DependentListProcess">
					<processReference refid="lsfProcess" />
					<processReference refid="mpiProcess_nina" />
				</dependentProcessSequence>
			</processDefinition>
			
			<!-- ssh process -->
			<processDefinition id="sshProcess_nef">
				<sshProcess class="org.objectweb.proactive.core.process.ssh.SSHProcess"  hostname="nef.inria.fr" username="smariani">
					<processReference refid="dpsProcess_nef" />
					<fileTransferDeploy refid="JACOBI">
						<copyProtocol>processDefault, scp, rcp</copyProtocol>
						<!-- local host path -->
						<sourceInfo prefix="${PROACTIVE_HOME}/src/org/objectweb/proactive/mpi/control/config/bin" />
						<!-- remote host path -->
						<destinationInfo prefix="${REMOTE_HOME_NEF}/MyApp" />
					</fileTransferDeploy>
				</sshProcess>
			</processDefinition>
						
			<!-- ssh process -->
			<processDefinition id="sshProcess_nina">
				<sshProcess class="org.objectweb.proactive.core.process.ssh.SSHProcess" hostname="cluster.inria.fr" username="smariani">
					<processReference refid="dpsProcess_nina" />
					<fileTransferDeploy refid="JACOBI">
						<copyProtocol>scp</copyProtocol>
						<!-- local host path -->
						<sourceInfo prefix="${PROACTIVE_HOME}/src/org/objectweb/proactive/mpi/control/config/bin" />
						<!-- remote host path -->
						<destinationInfo prefix="${REMOTE_HOME_NINA}/MyApp" />
					</fileTransferDeploy>
				</sshProcess>
			</processDefinition>
		</processes>
	</infrastructure>
</ProActiveDescriptor>
