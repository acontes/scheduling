<?xml version="1.0" encoding="UTF-8"?>
<ProActiveDescriptor xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:noNamespaceSchemaLocation=
"http://www-sop.inria.fr/oasis/proactive/schema/3.2/DescriptorSchema.xsd">
	<variables>
		<DescriptorVariable name="PROACTIVE_HOME" value="ProActive"/>
		<DescriptorVariable name="REMOTE_HOME" value="/home/smariani"/>
		<DescriptorVariable name="HOSTS_NUMBER" value="3"/>
		<DescriptorVariable name="MPIRUN_PATH" value="/usr/src/redhat/BUILD/mpich-1.2.6/bin/mpirun"/>
		<DescriptorVariable name="QSUB_PATH" value="/opt/torque/bin/qsub"/>
		<JavaPropertyVariable name="USER_HOME" value="java.home"/>
	</variables>
	<componentDefinition>
		<virtualNodesDefinition>
			<virtualNode name="JACOBIVN" />
		</virtualNodesDefinition>
	</componentDefinition>
	<deployment>
		<mapping>
			<map virtualNode="JACOBIVN">
				<jvmSet>
					<vmName value="Jvm1" />
				</jvmSet>
			</map>
		</mapping>
		<jvms>
			<jvm name="Jvm1">
				<creation>
					<processReference refid="sshProcess" />
				</creation>
			</jvm>
		</jvms>
	</deployment>
	<FileTransferDefinitions>
		<FileTransfer id="transfer">
			<!-- Transfer mpi program on remote host -->
			<file src="jacobi" dest="jacobi" />
		</FileTransfer>
	</FileTransferDefinitions>
	<infrastructure>
		<processes>

			<processDefinition id="localJVM1">
				<jvmProcess class="org.objectweb.proactive.core.process.JVMNodeProcess">
					<classpath>
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/ProActive.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/asm.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/log4j.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/components/fractal.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/xercesImpl.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/bouncycastle.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/trilead-ssh2.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/lib/javassist.jar" />
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/classes" />
					</classpath>
					<javaPath>
						<absolutePath value="${REMOTE_HOME}/jdk1.5.0_05/bin/java" />
					</javaPath>
					<policyFile>
						<absolutePath value="${REMOTE_HOME}/proactive.java.policy" />
					</policyFile>
					<log4jpropertiesFile>
						<absolutePath value="${REMOTE_HOME}/${PROACTIVE_HOME}/compile/proactive-log4j" />
					</log4jpropertiesFile>
					<jvmParameters>
						<parameter value="-Dproactive.useIPaddress=true" />
						<parameter value="-Dproactive.rmi.port=6099" />
					</jvmParameters>
				</jvmProcess>
			</processDefinition>

			<!-- remote jvm Process -->
			<processDefinition id="jvmProcess">
				<jvmProcess class="org.objectweb.proactive.core.process.JVMNodeProcess">
					<jvmParameters>
						<parameter value="-Dproactive.useIPaddress=true" />
						<parameter value="-Dproactive.rmi.port=6099" />
					</jvmParameters>
				</jvmProcess>
			</processDefinition>

			<!-- pbs Process -->
			<processDefinition id="pbsProcess">
				<pbsProcess class="org.objectweb.proactive.core.process.pbs.PBSSubProcess">
					<processReference refid="localJVM1" />
					<commandPath value=${QSUB_PATH} />
					<pbsOption>
						<hostsNumber>${HOSTS_NUMBER}</hostsNumber>
						<processorPerNode>1</processorPerNode>
						<bookingDuration>00:02:00</bookingDuration>
						<scriptPath>
							<absolutePath value="${REMOTE_HOME}/pbsStartRuntime.sh" />
						</scriptPath>
					</pbsOption>
				</pbsProcess>
			</processDefinition>

			<!-- mpi Process -->
			<processDefinition id="mpiJACOBI">
				<mpiProcess class="org.objectweb.proactive.core.process.mpi.MPIDependentProcess" mpiFileName="jacobi">
					<commandPath value=${MPIRUN_PATH} />
					<mpiOptions>
						<processNumber>${HOSTS_NUMBER}</processNumber>
						<localRelativePath>
							<relativePath origin="user.home" value="${PROACTIVE_HOME}/scripts/unix" />
						</localRelativePath>
						<remoteAbsolutePath>
							<absolutePath value="${REMOTE_HOME}/MyApp" />
						</remoteAbsolutePath>
					</mpiOptions>
				</mpiProcess>
			</processDefinition>

			<!-- dependent process -->
			<processDefinition id="dpsJACOBI">
				<dependentProcessSequence class="org.objectweb.proactive.core.process.DependentListProcess">
					<processReference refid="pbsProcess" />
					<processReference refid="mpiJACOBI" />
				</dependentProcessSequence>
			</processDefinition>

			<!-- ssh process -->
			<processDefinition id="sshProcess">
				<sshProcess class="org.objectweb.proactive.core.process.ssh.SSHProcess" hostname="nef.inria.fr" username="smariani">
					<processReference refid="dpsJACOBI" />
					<FileTransferDeploy refid="transfer">
						<copyProtocol>scp</copyProtocol>
						<!-- local host path -->
						<sourceInfo prefix="${USER_HOME}/${PROACTIVE_HOME}/src/org/objectweb/proactive/examples/mpi" />
						<!-- remote host path -->
						<destinationInfo prefix="${REMOTE_HOME}/MyApp" />
					</FileTransferDeploy>
				</sshProcess>
			</processDefinition>
		</processes>
	</infrastructure>
</ProActiveDescriptor>
