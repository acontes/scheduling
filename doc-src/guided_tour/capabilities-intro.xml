<?xml version="1.0" encoding="UTF-8"?>
<?xml-stylesheet type="text/css" href="../viewDocbook.css"?>
<chapter id="capabilities-intro">
  <title id="Introduction_Proactive_Features">Introduction to ProActive
  Features</title>

  <para>This chapter will present some of the features offered by ProActive,
  namely:</para>

  <itemizedlist>
    <listitem>
      <para>parallel processing: how you can run several tasks in
      parallel.</para>
    </listitem>

    <listitem>
      <para>synchronization: how you can synchronize tasks.</para>
    </listitem>

    <listitem>
      <para>migration: how you can migrate Active Objects.</para>
    </listitem>
  </itemizedlist>

  <sect1>
    <title>Parallel processing and collaborative application with
    ProActive</title>

    <para>Distribution is often used for CPU-intensive applications, where
    parallelism is a key for performance.</para>

    <para>A typical application is C3D.</para>

    <para>Note that parallelisation of programs can be facilitated with
    ProActive, thanks to asynchronous method calls (see <xref
    linkend="FutureObjectCreation" />), as well as group communications (see
    <xref linkend="TypedGroupCommunication" />).</para>
  </sect1>

  <sect1 id="C3D_example">
    <title>C3D: a parallel, distributed and collaborative 3D renderer</title>

    <para><ulink
    url="http://www-sop.inria.fr/oasis/ProActive/apps/c3d.html">C3D</ulink> is
    a Java benchmark application that measures the performance of a 3D
    raytracer renderer distributed over several Java virtual machines using
    Java RMI. It showcases some of the benefits of ProActive, notably the ease
    of distributed programming, and the speedup through parallel
    calculation.</para>

    <para>Several users can collaboratively view and manipulate a 3D scene.
    The image of the scene is calculated by a dynamic set of rendering engines
    using a raytracing algorithm, everything being controlled by a central
    dispatcher.</para>

    <figure>
      <title>The active objects in the c3d application</title>

      <mediaobject>
        <imageobject>
          <imagedata contentwidth="100"
                     fileref="guided_tour/pics/hello/c3d.png" format="PNG"
                     width="6in" />
        </imageobject>
      </mediaobject>
    </figure>

    <sect2>
      <title>Start C3D</title>

      <para>Using the script <literal>c3d_no_user</literal>, a "Dispatcher"
      object is launched (ie a centralized server) as well as 4 "Renderer"
      objects, which are active objects to be used for parallel
      rendering.</para>

      <para><figure>
          <title>the dispatcher GUI is launched</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="guided_tour/pics/screenshots/c3d_dispatcher_app.png"
                         format="PNG" width="4.5in" />
            </imageobject>
          </mediaobject>
        </figure></para>

      <para>The bottom part of the window allows to choose which renderers
      should participate in the rendering. You may want to stop using a given
      machine (because for instance it is overloaded), and thus remove it from
      the renderers used in the current computation.</para>
    </sect2>

    <sect2>
      <title>Start a user</title>

      <para>Using <literal>c3d_add_user</literal>,</para>

      <itemizedlist>
        <listitem>
          <para>Connect on the current host (proposed by default) by just
          giving your name.</para>
        </listitem>
      </itemizedlist>

      <para><informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata fileref="guided_tour/pics/screenshots/c3d_user_alice.png"
                         format="PNG" width="4.5in" />
            </imageobject>
          </mediaobject>
        </informalfigure></para>

      <para>For example, the user 'alice'</para>

      <itemizedlist>
        <listitem>
          <para>Spin the scene, add a random sphere, and observe how the
          action takes place immediately</para>
        </listitem>

        <listitem>
          <para>Add and remove renderers, and observe the effect on the 'speed
          up' indication from the user window.</para>
        </listitem>
      </itemizedlist>

      <para>Which configuration is the fastest for the rendering?</para>

      <para>Are you on a multi-processor machine?</para>

      <note>
        <para>You might not perceive the difference of the performance. The
        difference is better seen with more distributed nodes and objects (for
        example on a cluster) .</para>
      </note>
    </sect2>

    <sect2>
      <title>Start a user from another machine</title>

      <para>Using the <literal>c3d_add_user</literal> script, and
      <emphasis>specifying the host</emphasis> (set to local host
      bydefault)</para>

      <para><figure>
          <title>Specifying the host</title>

          <mediaobject>
            <imageobject>
              <imagedata fileref="guided_tour/pics/screenshots/c3d_specify_host.png"
                         format="PNG" />
            </imageobject>
          </mediaobject>
        </figure></para>

      <para>If you use rlogin, make sure the DISPLAY is properly set. You must
      use the same version of ProActive on both machines!</para>

      <itemizedlist>
        <listitem>
          <para>Test the collaborative behavior of the application when
          several users are connected.</para>
        </listitem>
      </itemizedlist>

      <para>Notice that a collaborative consensus must be reached before
      starting some actions (or that a timeout occured).</para>
    </sect2>

    <sect2>
      <title>Start IC2D to visualize the topology</title>

      <para>You will need at first to start IC2D using either
      ProActive/scripts/unix/ic2d.sh or ProActive/scripts/windows/ic2d.bat
      depending on your environment.</para>

      <para></para>

      <para>In order to visualize all Active objects, you need to acquire
      ('Monitoring/Monitor a new RMI host' menu):</para>

      <itemizedlist>
        <listitem>
          <para>The machine on which you started the 'Dispatcher'</para>
        </listitem>

        <listitem>
          <para>The machine on which you started the second user</para>

          <para>You'll need to type in the edit field asking it <emphasis>the
          name of each machine</emphasis> and the <emphasis>RMI
          port</emphasis> being used separated by a
          <emphasis>colon</emphasis>.</para>
        </listitem>
      </itemizedlist>

      <para><figure>
          <title>The C3D application when a new user joins in, seen with
          IC2D</title>

          <mediaobject>
            <imageobject>
              <imagedata contentwidth="100"
                         fileref="guided_tour/pics/screenshots/c3d_topology_with_new_user.png"
                         format="PNG" width="6in" />
            </imageobject>
          </mediaobject>
        </figure></para>

      <itemizedlist>
        <listitem>
          <para>Add random spheres for instance, and observe messages
          (Requests) between Active Objects.</para>
        </listitem>

        <listitem>
          <para>Add and remove renderers, and check graphically whether the
          corresponding Active Objects are contacted or not, in order to
          achieve the rendering.</para>
        </listitem>

        <listitem>
          <para>You can textually visualize this information by activating
          'add event timeline for this WorldObject' on the World panel with
          the right mouse button, and then 'show the event list window' on the
          top menu window</para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Drag-and-drop migration</title>

      <indexterm>
        <primary>Migration</primary>

        <secondary>drag-and-drop</secondary>
      </indexterm>

      <para>From IC2D, you can drag-and-drop active objects from one JVM to
      another. Click the right button on a C3DRenderingEngine, and drag and
      drop it in another JVM. Observe the migration taking place.</para>

      <para>Add a new sphere, using all rendering engines, and check that the
      messages are still sent to the active object that was asked to
      migrate.</para>

      <para>As migration and communications are implemented in a fully
      compatible manner, you can even migrate with IC2D an active object while
      it is communicating (for instance when a rendering action is in
      progress). Give it a try!</para>

      <note>
        <para>You can also migrate Active Objects which create a GUI. If you
        do that for the User, you will see the graphical window beiung
        destroyed, and rebuilt once more.</para>
      </note>
    </sect2>

    <sect2>
      <title>Start a new JVM in a computation</title>

      <para>Manually you can start a new JVM - a 'Node' in the ProActive
      terminology - that will be used in a running system.</para>

      <itemizedlist>
        <listitem>
          <para>On a different machine, or by remote login on another host,
          start another Node, named for instance NodeZ</para>
        </listitem>
      </itemizedlist>

      <screen>linux&gt; startNode.sh rmi://mymachine/NodeZ &amp;
windows&gt; startNode.bat rmi://mymachine/NodeZ </screen>

      <para>The node should appear in IC2D when you request the monitoring of
      the new machine involved (Monitoring menu, then 'monitor new RMI
      host'.</para>

      <itemizedlist>
        <listitem>
          <para>The node just started has no active object running in it. Drag
          and drop one of the renderers, and check that the node is now taking
          place in the computation</para>
        </listitem>

        <listitem>
          <para>Spin the scene to trigger a new rendering</para>
        </listitem>

        <listitem>
          <para>See the topology</para>
        </listitem>
      </itemizedlist>

      <note>
        <para>If you feel uncomfortable with the automatic layout, switch to
        manual using the 'manual layout' option (right click on the World
        panel). You can then reorganize the layout of the machines.</para>
      </note>

      <itemizedlist>
        <listitem>
          <para>To fully distribute the computation, start several nodes (you
          need 2 more) and drag-and drop renderers in them.</para>
        </listitem>
      </itemizedlist>

      <para>Depending on the machines you have, the complexity of the image,
      look for the most efficient configuration.</para>
    </sect2>

    <sect2>
      <title>Wrapping Active Objects in Components</title>

      <para>You can also write components with the Fractive API, which is an
      implementation of Fractal in ProActive. You should check the section on
      components for more information (<xref
      linkend="ProActiveComponents" />). There is a long explanation of the
      C3D component version (<xref linkend="C3D_component_example" />). The
      visual aspect is very similar to the standard Active Object C3D version.
      That's on purpose, to show how easy it is to transform code into
      components. If you want to run a components version of c3d, try
      this:</para>

      <screen>scripts/unix/components$ ./c3d.sh  ../../../descriptors/components/C3D_all.xml
scripts/windows/components$ c3d.bat ..\..\..\descriptors\components\C3D_all.xml</screen>

      <para>The component binding is done through the Fractal ADL, which is a
      standard way of writing components through an xml file. You can have a
      visual representation with IC2D (start IC2D,
      menu-&gt;Components-&gt;Start the components GUI). You should specify
      how to read the file. You have to enter:</para>

      <itemizedlist>
        <listitem>
          <para>File-&gt;Storage: <literal>ProActive/src</literal>.</para>
        </listitem>

        <listitem>
          <para>File-&gt;Open:<literal>ProActive/src/org/objectweb/proactive/examples/components/c3d/adl/userAndComposite.fractal</literal>.</para>
        </listitem>
      </itemizedlist>

      <figure>
        <title>IC2D component explorer with the C3D example</title>

        <mediaobject>
          <imageobject>
            <imagedata contentwidth="100"
                       fileref="components/pics/c3d_components.png"
                       format="PNG" width="6in" />
          </imageobject>
        </mediaobject>
      </figure>
    </sect2>

    <sect2>
      <title>Look at the source code for the main classes</title>

      <para>The main classes of this application are:</para>

      <itemizedlist>
        <listitem>
          <para><literal>org.objectweb.proactive.examples.c3d.C3DUser.java</literal></para>
        </listitem>
      </itemizedlist>

      <itemizedlist>
        <listitem>
          <para><literal>org.objectweb.proactive.examples.c3d.C3DRenderingEngine.java</literal></para>
        </listitem>
      </itemizedlist>

      <itemizedlist>
        <listitem>
          <para><literal>org.objectweb.proactive.examples.c3d.C3DDispatcher.java</literal></para>
        </listitem>
      </itemizedlist>

      <para>In the Dispatcher, look at the method <literal>public void
      rotateScene(int i_user, String i_user_name, Vec angle) </literal> that
      handles election of the next action to undertake.</para>
    </sect2>
  </sect1>

  <sect1>
    <title>Synchronization with ProActive</title>

    <para>ProActive provides an advanced synchronization mechanism that allows
    an easy and safe implementation of potentially complex synchronization
    policies.</para>

    <para>This is illustrated by two examples:</para>

    <itemizedlist>
      <listitem>
        <para>The readers and the writers</para>
      </listitem>

      <listitem>
        <para>The dining philosophers</para>
      </listitem>
    </itemizedlist>

    <sect2>
      <title>The readers-writers</title>

      <para>The readers and the writers want to access the same data. In order
      to allow concurrency while ensuring the consistency of the readings,
      accesses to the data have to be synchronized upon a specified policy.
      Thanks to ProActive, the accesses are guaranteed to be allowed
      sequentially.</para>

      <para>The <ulink
      url="http://www-sop.inria.fr/oasis/ProActive/apps/readers.html">implementation
      with ProActive</ulink> uses 3 active objects: Reader, Writer, and the
      controller class (ReaderWriter).</para>

      <sect3>
        <title>Start the application</title>

        <para><figure>
            <title>Using the readers script</title>

            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/readers_console.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </figure></para>

        <para>ProActive starts a node (i.e. a JVM) on the current machine, and
        creates 3 Writer, 3 Reader, a ReaderWriter (the controller of the
        application) and a ReaderDisplay, that are active objects.</para>

        <para><figure>
            <title>A GUI is started that illustrates the activities of the
            Reader and Writer objects.</title>

            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/readers_app.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </figure></para>
      </sect3>

      <sect3>
        <title>Check the effect of different policies: even, writer priority,
        reader priority</title>

        <para>What happens when priority is set to 'reader priority'?</para>
      </sect3>

      <sect3>
        <title>Look at the code for programming such policies</title>

        <para>in
        <literal>org.objectweb.proactive.examples.readers.ReaderWriter.java</literal>.
        More specifically, look at the routines in:</para>

        <screen>public void evenPolicy(org.objectweb.proactive.Service service)</screen>

        <screen>public void readerPolicy(org.objectweb.proactive.Service service)</screen>

        <screen>public void writerPolicy(org.objectweb.proactive.Service service)</screen>

        <para>Look at the inner class <literal>MyRequestFilterm</literal> that
        implements
        <literal>org.objectweb.proactive.core.body.request.RequestFilter</literal>.
        How does it work?</para>
      </sect3>

      <sect3>
        <title>Introduce a bug in the Writer Priority policy</title>

        <para>For instance, let several writers go through at the same
        time.</para>

        <itemizedlist>
          <listitem>
            <para>Observe the Writer Policy policy before recompiling</para>
          </listitem>

          <listitem>
            <para>Recompile (using compile.sh readers or compile.bat
            readers)</para>
          </listitem>

          <listitem>
            <para>Observe that stub classes are regenerated and
            recompiled</para>
          </listitem>

          <listitem>
            <para>Observe the difference due to the new synchronization
            policy: what happens now?</para>
          </listitem>

          <listitem>
            <para>Correct the bug and recompile again ; check that everything
            is back to normal</para>
          </listitem>
        </itemizedlist>
      </sect3>
    </sect2>

    <sect2>
      <title>The dining philosophers</title>

      <para>The 'dining philosophers' problem is a classic exercise in
      concurrent programming. The goal is to avoid deadlocks.</para>

      <para>We have provided <ulink
      url="http://www-sop.inria.fr/oasis/ProActive/apps/phil.html">an
      illustration of the solution</ulink> using ProActive, where all the
      philosophers are active objects, as well as the table (controller) and
      the dinner frame (user interface).</para>

      <sect3>
        <title>Start the philosophers application</title>

        <para><figure>
            <title>With philosophers.sh or philosophers.bat</title>

            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/philosophers_console.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </figure></para>

        <para>ProActive creates a new node and instantiates the active objects
        of the application: DinnerLayout, Table, and Philosopher</para>

        <para><figure>
            <title>The GUI is started.</title>

            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/philosophers_app.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </figure></para>
      </sect3>

      <sect3>
        <title>Understand the color codes</title>

        <para>The pictures represent the state of the philosophers. They can
        be:</para>

        <itemizedlist>
          <listitem>
            <para><inlinemediaobject>
                <imageobject>
                  <imagedata fileref="guided_tour/pics/think.png" format="PNG" />
                </imageobject>
              </inlinemediaobject> <emphasis
            role="bold">philosophing</emphasis></para>
          </listitem>

          <listitem>
            <para><inlinemediaobject>
                <imageobject>
                  <imagedata fileref="guided_tour/pics/wait.png" format="PNG" />
                </imageobject>
              </inlinemediaobject> <emphasis role="bold">hungry, wants the
            fork!</emphasis></para>
          </listitem>

          <listitem>
            <para><inlinemediaobject>
                <imageobject>
                  <imagedata fileref="guided_tour/pics/eat.png" format="PNG" />
                </imageobject>
              </inlinemediaobject> <emphasis
            role="bold">eating</emphasis></para>
          </listitem>
        </itemizedlist>

        <para>The forks can have two states:</para>

        <itemizedlist>
          <listitem>
            <para><inlinemediaobject>
                <imageobject>
                  <imagedata fileref="guided_tour/pics/fork1.png" format="PNG" />
                </imageobject>
              </inlinemediaobject> <emphasis
            role="bold">taken</emphasis></para>
          </listitem>

          <listitem>
            <para><inlinemediaobject>
                <imageobject>
                  <imagedata fileref="guided_tour/pics/fork0.png" format="PNG" />
                </imageobject>
              </inlinemediaobject> <emphasis
            role="bold">free</emphasis></para>
          </listitem>
        </itemizedlist>
      </sect3>

      <sect3>
        <title>Test the autopilot mode</title>

        <para>The application runs by itself without encountering a
        deadlock.</para>
      </sect3>

      <sect3>
        <title>Test the manual mode</title>

        <para>Click on the philosophers' heads to switch their modes</para>

        <para>Test that there are no deadlocks!</para>

        <para>Test that you can starve one of the philosophers (i.e. the
        others alternate eating and thinking while one never eats!)</para>
      </sect3>

      <sect3>
        <title>Start the IC2D application</title>

        <indexterm>
          <primary>IC2D</primary>

          <secondary>example usage</secondary>
        </indexterm>

        <para><ulink
        url="http://www-sop.inria.fr/oasis/ProActive/IC2D/index.html">IC2D</ulink>
        is a graphical environment for monitoring and steering of distributed
        and Grid Computing applications.</para>

        <itemizedlist>
          <listitem>
            <para>Being in the autopilot mode, start the IC2D visualization
            application (using ic2d.sh or ic2d.bat)</para>
          </listitem>
        </itemizedlist>

        <para><informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/ic2d_console.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </informalfigure></para>

        <para><informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="100"
                           fileref="guided_tour/pics/screenshots/jc2d_main_panel.png"
                           format="PNG" width="6in" />
              </imageobject>
            </mediaobject>
          </informalfigure></para>

        <para><informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata contentwidth="100"
                           fileref="guided_tour/pics/screenshots/ic2d_evt_listener_panel.png"
                           format="PNG" width="6in" />
              </imageobject>
            </mediaobject>
          </informalfigure></para>

        <para>The ic2d GUI is started. It is composed of 2 panels: the main
        panel and the request queue panel</para>

        <itemizedlist>
          <listitem>
            <para>Acquire your current machine</para>
          </listitem>
        </itemizedlist>

        <figure>
          <title>Monitoring new RMI host with IC2D</title>

          <mediaobject>
            <imageobject>
              <imagedata contentwidth="100"
                         fileref="guided_tour/pics/screenshots/monitor_new_rmi_host_menu.png"
                         format="PNG" width="4in" />
            </imageobject>
          </mediaobject>
        </figure>

        <para>It is possible to visualize the status of each active object
        (processing, waiting etc...), the communications between active
        objects, and the topology of the system (here all active objects are
        in the same node):</para>

        <para><informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/ic2d_world_panel_philosophers.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </informalfigure></para>

        <para><informalfigure>
            <mediaobject>
              <imageobject>
                <imagedata fileref="guided_tour/pics/screenshots/ic2d_legend.png"
                           format="PNG" />
              </imageobject>
            </mediaobject>
          </informalfigure></para>
      </sect3>
    </sect2>
  </sect1>

  <sect1>
    <title>Migration of active objects</title>

    <indexterm>
      <primary>Migration</primary>

      <secondary>example</secondary>
    </indexterm>

    <para>ProActive allows the transparent migration of objects between
    virtual machines.</para>

    <para>A nice visual example is the penguin's one.</para>

    <para>This example shows a set of <ulink
    url="http://www-sop.inria.fr/oasis/ProActive/apps/penguin.html">mobile
    agents</ulink> moving around while still communicating with their base and
    with each other. It also features the capability to move a swing window
    between screens while moving an agent from one JVM to the other.</para>

    <sect2>
      <title>Start the penguin application</title>

      <para>Using the <literal>migration/penguin</literal> script.</para>
    </sect2>

    <sect2>
      <title>Start IC2D to see what is going on</title>

      <para>Using the <literal>ic2d</literal> script</para>

      <para>Acquire the machines you have started nodes on</para>
    </sect2>

    <sect2>
      <title>Add an agent</title>

      <itemizedlist>
        <listitem>
          <para>On the Advanced Penguin Controller window: button 'add
          agent'</para>
        </listitem>
      </itemizedlist>

      <para><informalfigure>
          <mediaobject>
            <imageobject>
              <imagedata fileref="guided_tour/pics/screenshots/penguin.png"
                         format="PNG" />
            </imageobject>
          </mediaobject>
        </informalfigure></para>

      <para>An agent is materialized by a picture in a java window.</para>

      <itemizedlist>
        <listitem>
          <para>Select it, and press button 'start'</para>
        </listitem>

        <listitem>
          <para>Observe that the active object is moving between the machines,
          and that the penguin window disappears and reappears on the screen
          associated with the new JVM.</para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Add several agents</title>

      <para>After selecting them, use the buttons to:</para>

      <itemizedlist>
        <listitem>
          <para>Communicate with them ('chained calls')</para>
        </listitem>

        <listitem>
          <para>Start, stop, resume them</para>
        </listitem>

        <listitem>
          <para>Trigger a communication between them ('call another
          agent')</para>
        </listitem>
      </itemizedlist>
    </sect2>

    <sect2>
      <title>Move the control window to another user</title>

      <itemizedlist>
        <listitem>
          <para>Start the same script on a different computer, using another
          screen and keyboard</para>
        </listitem>

        <listitem>
          <para>Monitor the corresponding JVM with IC2D</para>
        </listitem>

        <listitem>
          <para>Drag-and-drop the active object 'AdvancedPenguinController'
          with IC2D into the newly created JVM: the control window will appear
          on the other computer</para>
        </listitem>

        <listitem>
          <para>And its user can now control the penguins application.</para>
        </listitem>

        <listitem>
          <para>Still with IC2D, doing a drag-and-drop back to the original
          JVM, you will be able to get back the window, and control yourself
          the application.</para>
        </listitem>
      </itemizedlist>
    </sect2>
  </sect1>
</chapter>